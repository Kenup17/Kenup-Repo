#independent_records v3.0

ind_record<-function(sp,indiv,station,age=NULL, time, z, var=NULL){
	if(is(time)[1]!="POSIXct"){stop("Time must be inserted as POSIXct class object")}
	if (is.null(age)){age<-rep(1,length(time))} ##Gambiarrinha pra fingir que todas as linhas possuem idades iguais (logo, a idade nao importa)
	dados<-data.frame(sp, indiv, station, age, time)		#creates main data.frame
		if(!is.null(var)){dados<-cbind(dados,var)}  # pool desirable variables together with photo data
	dados<-dados[order(dados$sp, dados$indiv, dados$age, dados$station, dados$time, decreasing=F),] #order dataframe in relevant manner
	independent<-T #logical vector, 1st element TRUE
	wpb<-winProgressBar(title="Selecting independent photos",label="Selecting independent photos")
	for (i in 2:nrow(dados)){
		setWinProgressBar(wpb,i)
		li<-max(which(independent==T))
		if(dados$sp[i]==dados$sp[li] & dados$station[i]==dados$station[li] & dados$indiv[i]==dados$indiv[li] & dados$age[i]==dados$age[li]){
		 if(abs(as.numeric(difftime(dados$time[li],dados$time[i],units="mins")))<z){independent[i]<-F}
			else{independent[i]<-T}
		}
		else{independent[i]<-T}
	}
	dados<-cbind(dados,independent)
	close(wpb)
	return(dados)
}